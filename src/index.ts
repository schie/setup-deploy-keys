import * as core from '@actions/core';

import { addDeployKeys, DeployKeyData } from './add-deploy-keys';
import { createGitConfig } from './create-git-config';
import { createSSHConfig } from './create-ssh-config';
import { setupKnownHosts } from './setup-known-hosts';
import { startSSHAgent } from './start-ssh-agent';
import { getFileName } from './utils';

function doTheThing() {
  const deployKeyData = JSON.parse(core.getInput('deployKeyData')) as DeployKeyData[];
  // const deployKeyData = [
  //   {
  //     packageName: 'yd-krypto',
  //     ownerName: 'yellowdogsoftware',
  //     privateKey:
  //       '-----BEGIN OPENSSH PRIVATE KEY-----\n    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\n    -----END OPENSSH PRIVATE KEY-----\n    '
  //   },
  //   {
  //     packageName: 'graphql-type-guid',
  //     ownerName: 'yellowdogsoftware',
  //     privateKey:
  //       '-----BEGIN OPENSSH PRIVATE KEY-----\n    b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAACFwAAAAdzc2gtcn\n    NhAAAAAwEAAQAAAgEA3Uc9b8at1oKaJVqiQyNGhaFne+t+7tE+CC/VnRMqKbFkCQWYudA+\n    8xSYK71UiqK6vBbO9W+AfAi+6VyU4h7tOhkP0TncPvkThYNNFukzOI8P6cTAUEvlHJX3/y\n    Y5WJpSYWSLI555D8wVxIlT8xyXboEv8wvMQpyHLs6uK0jPCyh67UFUy1SOBxwOFhdYzZ0s\n    GXApeSlyGFqzDjatVTevuX4rgDqlQOR/3AaYE0RGFYt1fvr7ODC9T+fh4NESROXcrPqrzt\n    Ft0ydAc+ZSlS3mTRGIBjxknHGiBqTCit0iTK4HSm+ahvNPyuLsUCB6X6c9BgPFRFudlzDK\n    qY3YIJ4QPEKebfe1byIeQocEz7j5rkNBLifMnCfjGFG1+zxUdBae7VUBju4YsYw0EURt53\n    QrjRFkyRnxR7FNDGmh6b6bZtZujUWE1lr9xjZKIQJinsf/eVI0zMGE2yMI5VcN17HIvyT+\n    YJWmHPbOc0x9XsWXWMOBB+8DPCMbc2GRyDMf/rafinkxGyPHj6ms37IU+gIMrLERvzSHK4\n    Emr6ugBylw57NSs/b2u75TjOnCS7dy/hOw/ItRtsnU9wM+RZwTkqa6XCtB21cj4p+fvFKP\n    V6l/6l2nBpRpEfeENHj6m1q9SgszeHHJSoEHTejI+wdtMi7BQtZdrM3LtBthkMRfaCtKl1\n    UAAAdQ1/YrVtf2K1YAAAAHc3NoLXJzYQAAAgEA3Uc9b8at1oKaJVqiQyNGhaFne+t+7tE+\n    CC/VnRMqKbFkCQWYudA+8xSYK71UiqK6vBbO9W+AfAi+6VyU4h7tOhkP0TncPvkThYNNFu\n    kzOI8P6cTAUEvlHJX3/yY5WJpSYWSLI555D8wVxIlT8xyXboEv8wvMQpyHLs6uK0jPCyh6\n    7UFUy1SOBxwOFhdYzZ0sGXApeSlyGFqzDjatVTevuX4rgDqlQOR/3AaYE0RGFYt1fvr7OD\n    C9T+fh4NESROXcrPqrztFt0ydAc+ZSlS3mTRGIBjxknHGiBqTCit0iTK4HSm+ahvNPyuLs\n    UCB6X6c9BgPFRFudlzDKqY3YIJ4QPEKebfe1byIeQocEz7j5rkNBLifMnCfjGFG1+zxUdB\n    ae7VUBju4YsYw0EURt53QrjRFkyRnxR7FNDGmh6b6bZtZujUWE1lr9xjZKIQJinsf/eVI0\n    zMGE2yMI5VcN17HIvyT+YJWmHPbOc0x9XsWXWMOBB+8DPCMbc2GRyDMf/rafinkxGyPHj6\n    ms37IU+gIMrLERvzSHK4Emr6ugBylw57NSs/b2u75TjOnCS7dy/hOw/ItRtsnU9wM+RZwT\n    kqa6XCtB21cj4p+fvFKPV6l/6l2nBpRpEfeENHj6m1q9SgszeHHJSoEHTejI+wdtMi7BQt\n    ZdrM3LtBthkMRfaCtKl1UAAAADAQABAAACAGPoRG7xT4/oy9xNvbF+fdrb8zNaMqd1RgLA\n    RjxzaLgGZdpE8p4CzklGZSZqh39I1fMSgUMDowldkYUfzgECYa23nxKigzTTlOLVU7sic4\n    P35AFyWjpm6f0sIRrMkVvV4Zgjo0bjyFk/lhx0vLipkh3Mqm+cRg9VSRvzKWRVrVWmY0o4\n    Eyby+GVxX1LOG8RKUJzzrWYNNnyUhv/F5CDz0Z14v/9Xe0F/adNYDtW0H8iefOBmRYMrTm\n    6DjdLJ0uvUtPxM+cGZgXKy6EDsHyFH5hGp9raKEgsoqzVAsq2sBk6EzLnpBeYkeURrjLLo\n    1xfVFJJgpXKlwtN+riI77vdbJoyXMi2UDW9tkWBAmZ0KvEE3tjEzFqxmUSsIUoslnYtEiS\n    VA2uvgbFT/ltqtqPmwwCAmDUBqiwHtg2K4lv82P2tcgHzKn39WXG6x91kFfwd9GGai+czr\n    +FAOnL/8XF6b2OCGQJOG/y2bsO5e/8Fm+vWwV37jkV5SKFttQ9X7eVNualaGQuNciK3PK2\n    Dc3akKsjPCAwSgYKgErOfX2M5KuSiYK5F0K3PH49U3h0/+NgnvIo1WdT7SCppJf9u8Dw2F\n    KGjye0fUvG759bVr3SKWixEmx7NBmj9r8nvGrWyOnEVjqlwavlAHcLE7vj7qtX/m4miWna\n    wvqV+iNe8bBDky/SLJAAABAQCm21AdRG9tdUUBO9YvgcDJNuvLr8prXbzSXM2j4jd5oCbe\n    bSTXEIECSpyjB7X/EN2nEh8HgcnLnzbUzPJe6llMsCuCD1g6us6f7eYm8KRXCLPPtW694w\n    yI2MsbcOBDoD181IhVehw+2QO+QvI3auAbMBf17rS6W39KrDApZoE0JlUGpqB2vNrHhBlD\n    QUd+jy/J9aVCSY3mK55SaZ+r8I8inOKtT4ATTbqwo6UwCcq7zjujbGtyk6wOAa8EBRBgY5\n    9y6fkMdefc/m/oQf/r/EwMsMACrEiFKTFgkZZTF/Hv4Lbjpv0UToK+l8sTtF0G4XIpSg0F\n    6qFzt3cb3f187RFrAAABAQD/7ADEGgrMW9cgG91SJtKcJrzLAuCGn9q8qXaagzo+Xr4YE4\n    JO0m2EdQCpty45JcFghdO2/NoIazUoXDwQIHEuSzViGHu80gLV81Kdk7TUNTkwn53lNo2o\n    SrWWDkHx/9YNPjd8jDnGqvUJV9UKCyBJgtL+KdozHvCo39LaBdEaNoXLAu9H2bGQVwL1lz\n    9k38NPEJuhEP3v0X9sDdbyXwzrN9JAE392NtOrvO0c1j8DlbFAmcfNHIllEz+iXhqCfCJF\n    eILu0oFZC+JvGBku7FPL5uYGwfm7LV9UQ1sTAmlVyUZJXuLMvsU4XEb2+feNeVJKsWntkD\n    5HLZ9FplyOXg0/AAABAQDdWIew0jILG1MbzFSg6pksowI2meB6IG6oiTEbw4yAS5bQip5+\n    Svop8Eo8lnEG4830waArm2ZNJZkRU95lfX0+sarzftEX/LCDL+9QegQhgYKqyvq6amcY8E\n    YiclS9R8GzeCoAYtl9on9sFbPBbXwESWm0yaesV686eaA4+e9AsDH9/M8IYW6rBICqBi6u\n    LHU1KlCfD5n+txo7coFNPWUtkbkSU7BkN0HN3+3/zQDolQAVa3W7oYiF+h0t/f2MByY7x/\n    nGxgFyjmOBDtmsaZ0GVOqkjI9iKiiEaLxuEQwj3OryJj3H5hubO5diew/jTp+KbMBzWO8B\n    pQrntPFRq3JrAAAAGGdyYXBocWxfdHlwZV9ndWlkQGRlcGxveQEC\n    -----END OPENSSH PRIVATE KEY-----\n    '
  //   }
  // ];

  const sshConfigData = deployKeyData.map(({ ownerName, packageName }) => ({
    hostAlias: packageName,
    identityFileName: getFileName(ownerName, packageName)
  }));

  createSSHConfig(sshConfigData as any);
  createGitConfig(deployKeyData as any);
  startSSHAgent();
  addDeployKeys(deployKeyData);
  setupKnownHosts();
}

doTheThing();
